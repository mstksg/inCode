<!DOCTYPE HTML>
<html><head><title>The Hamster Hotel: An Introduction to Control Theory (Part 2) · in Code</title><meta name="description" content="Weblog of Justin Le, covering various adventures in programming and explorations in the worlds of computation physics, and knowledge.
"><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta name="flattr:id" content="3p9jqr"><meta property="og:site_name" content="in Code"><meta property="og:description" content="As we left it off in part 1, our elevator is still in trouble. You have an elevator for your humble hotel that consists of a plate being pushed up a shaft with a fountain of water where we can control the fountain strength, but you don’t really have any way to automate getting it to go to just the right height. You’ve tried writing down the proper fountain strengths for every floor, but changes in weight of the hamsters and lots of other factors make this unreliable. You’ve tried mathematically analyzing and accounting for all of these other factors, but not only is it impractical, but it can’t possibly account for dynamic changes in the system. Let’s take a look at a possible solution that might have some promise."><meta property="og:type" content="article"><meta property="og:title" content="The Hamster Hotel: An Introduction to Control Theory (Part 2)"><meta property="og:image" content="https://blog.jle.im/img/site_logo.jpg"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://blog.jle.im/entry/the-hamster-hotel-an-introduction-to-control-theory-2.html"><meta name="twitter:card" content="summary"><meta name="twitter:creator:id" content="mstk"><link rel="author" href="https://plus.google.com/107705320197444500140"><link rel="alternate" type="application/rss+xml" title="in Code (RSS Feed)" href="http://feeds.feedburner.com/incodeblog"><link rel="canonical" href="https://blog.jle.im/entry/the-hamster-hotel-an-introduction-to-control-theory-2.html"><link href="https://blog.jle.im/favicon.ico" rel="shortcut icon"><link href="https://blog.jle.im/css/toast.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/font.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/main.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/page/entry.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/pygments.css" rel="stylesheet" type="text/css"><script type="text/javascript">var page_data = {};
var disqus_shortname='incode';
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-443711-8', 'jle.im');
ga('send', 'pageview');
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script><script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5234d67a6b68dcd4"></script><script type="text/javascript" src="https://blog.jle.im/js/page/entry_toc.js"></script><script type="text/javascript" src="https://blog.jle.im/js/disqus_count.js"></script><script type="text/javascript" src="https://blog.jle.im/js/social.js"></script><script type="text/javascript" src="https://blog.jle.im/js/jquery/jquery.toc.js"></script><script type="text/javascript" src="https://blog.jle.im/purescript/entry.js"></script></head><body><div id="fb-root"><script>(function(d, s, id) {
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) return;
 js = d.createElement(s); js.id = id;
 js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=641852699171929";
 fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script></div><div id="header-container"><div id="navbar-container" class="tile"><nav id="navbar-content"><div class="nav-info"><h1 class="site-title"><a href="https://blog.jle.im/" class="nav-title">in Code</a></h1><span class="nav-author">Justin Le</span></div><ul class="nav-links"><li><a href="https://blog.jle.im/">home</a></li><li><a href="https://blog.jle.im/entries.html">archives</a></li><li><a href="https://cv.jle.im">cv</a></li><div class="clear"></div></ul></nav></div><div id="header-content"></div></div><div id="body-container" class="container"><div id="main-container" class="grid"><div class="entry-section unit span-grid" role="main"><article class="tile article"><header><h1 id="title">The Hamster Hotel: An Introduction to Control Theory (Part 2)</h1><p class="entry-info">by <a class="author" href="https://blog.jle.im/">Justin Le</a><span class="info-separator"> &diams; </span><time datetime="2013-10-01T11:47:41Z" pubdate="" class="pubdate">Tuesday October 1, 2013</time></p><p><span class="source-info"><a class="source-link" href="https://github.com/mstksg/inCode/tree/master/copy/entries/control-intro-2.md">Source</a><span class="info-separator"> &diams; </span><a class="source-link" href="https://github.com/mstksg/inCode/tree/gh-pages/entry/the-hamster-hotel-an-introduction-to-control-theory-2.md">Markdown</a><span class="info-separator"> &diams; </span><a class="source-link" href="https://blog.jle.im/entry/the-hamster-hotel-an-introduction-to-control-theory-2.tex">LaTeX</a><span class="info-separator"> &diams; </span></span>Posted in <a href="https://blog.jle.im/entries/category/@engineering.html" class="tag-a-category" title="Posts about engineering, the practical art of taming the physical world.
">Engineering</a>, <a href="https://blog.jle.im/entries/category/@ramblings.html" class="tag-a-category" title="My slight ramblings on subjects of interest (to me and hopefully to you too!).
Lots of surveys and introducts to new subjects.
">Ramblings</a><span class="info-separator"> &diams; </span><a class="comment-link" href="#disqus_thread">Comments</a></p></header><hr><aside class="contents-container"><h5 id="contents-header">Contents</h5><div id="toc"></div></aside><div class="main-content copy-content"><p>As we left it off in <a href="/entry/the-hamster-hotel-an-introduction-to-control-theory">part 1</a>, our elevator is still in trouble. You have an elevator for your humble hotel that consists of a plate being pushed up a shaft with a fountain of water where we can control the fountain strength, but you don’t really have any way to automate getting it to go to just the right height.</p>
<p>You’ve tried writing down the proper fountain strengths for every floor, but changes in weight of the hamsters and lots of other factors make this unreliable. You’ve tried mathematically analyzing and accounting for all of these other factors, but not only is it impractical, but it can’t possibly account for dynamic changes in the system.</p>
<p>Let’s take a look at a possible solution that might have some promise.</p>
<h2 id="i-detect-a-clue">I Detect a Clue</h2>
<p>You decide to put aside your elevator problems for now and focus on other aspects of your business. You do very well, actually, and your hotel grows to large acclaim in the hamster world. Still, you can’t help but be embarrassed every day when you explain that your elevator is still not adequately controllable.</p>
<p>You gain enough revenue that you decide to try things again with a human factor. You hire an elevator boy.</p>
<p>Your scheme is simple: have a little bell attached at the point where every elevator reaches the perfect height. Your elevator boy will turn the knob up, up, up until he hears the bell, and then stop it right after.</p>
<p>The same thing works for going down – tell him to turn the knob down, down until he hears a bell.</p>
<p>And suddenly, things seem to click.</p>
<h3 id="the-key">The Key</h3>
<p>This system accounts for all of the problems we ran into before. We have a human here who can account for everything. He makes all of the adjustments on the fly. He doesn’t need to know any exact percentages … he doesn’t need to worry about water pressure or friction or hamster weights, or any of that stuff. All he needs to know is “should I be increasing the flow, decreasing it, or leaving it alone?” So maybe the heavier hamsters get to their destinations slower — so what? You’ve discovered something amazing.</p>
<p>The key difference here is the <em>detection</em>. You are no longer thinking of a static system that will never change — you are constantly adjusting on the fly. You are doing things, detecting the reactions, and responding to those detections. In control theory, this difference is what we call <strong>feedback</strong>.</p>
<p><strong><em>Feedback</em> is the process of letting what you <em>observe</em> from your changes affect what you <em>change next, on the fly</em></strong>, which then affects what you <em>observe</em>, etc. etc.</p>
<p>And <em>this</em> is the key.</p>
<p>In control theory, this would be known as moving from an <strong>open loop</strong> (where we don’t let what we observe affect what we change on-the-fly) to a <strong>closed loop</strong> (where we do).</p>
<p>Also note one other fundamental shift we just made: Based on what we observe, we <em>change</em>. We no longer are finding out what we should <em>set</em> — we are instead figuring out how we should <em>change</em>. We don’t care about 10%, 20%, 30%, etc. anymore — we only care about twisting the knob <em>left</em> or <em>right</em>.</p>
<h3 id="simple-improvements">Simple Improvements</h3>
<p>Still, this system isn’t perfect. Sometimes, if you forget to feed your elevator boy, he will accidentally miss the bell and overshoot slightly. No big deal. You attach some <a href="http://www.snapcircuits.net/">very simple electronics</a> to your elevator shaft so that a <em>red</em> light comes on if the elevator is too low, a <em>blue</em> light comes on if it’s too high, and a <em>green</em> light if it’s just right.</p>
<p>Finally, with all of the electronics installed, your elevator boy knows three rules: increase the flow if the light is red, decrease the flow if it’s blue, and leave it constant if it’s green.</p>
<p>Of course, you were hoping (from the beginning) to be able to do have this be done without human intervention.</p>
<p>One day, you figure out that you can do the entire thing electronically. To save money, you fire your elevator boy and set up a motor to twist the knob. In addition to the lights, your circuit will also trigger the motor to loosen the valve (spin right) if the car is too low, tighten it (spin left) if it’s too high, and stop the motor when it is just right.</p>
<p>Congratulations, you now have your very first automated closed feedback loop, known as the <a href="http://en.wikipedia.org/wiki/Bang%E2%80%93bang_control">bang–bang controller</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>With this in hand, you are sure to have no obstacles to firmly establishing your hamster hotel empire.</p>
<h3 id="problems-again">Problems Again</h3>
<p>Of course, our bang–bang controller is (as you might expect from the crudeness of the name) not exactly the be-all and end-all solution that control theory exists to provide.</p>
<p>Let’s look at its shortcomings even in our simple scenario.</p>
<p>In reality, the light will almost never be green for long. If a platform is properly aligned as a hamster steps on it, it will be nudged off balance. The light will immediately turn red, the motor will immediately adjust the jet and the car at full speed. This is felt as a “jitter” (Which, as I have on good word, is a particularly unpleasant sensation for a hamster.)</p>
<p>Could you possibly make the “adjustment speed” slower? That is, could you slow down the speed that your motor runs at, so that the adjustment is slow enough as to not be felt as a rapid jitter?</p>
<p>Well, you can! But if your motor is slow, it will actually take much too long to ever move anywhere. Perhaps the proper non-jittering motor speed is the same speed that would cause the car to take an hour to move up one story. Not acceptable!</p>
<p>You either jitter, or you take too long to move anywhere. Whatever motor speed you choose will always have one problem or the other.</p>
<p>Furthermore, here we assume that our motor can instantly react to the changes in the red/blue/green lights. However, real-world motors can’t simply change their direction immediately. Have you ever tried getting a car going 60 mph forwards to move 60 mph backwards instantly?</p>
<p>Imagine applying this, then, to the elevator. It’ll move up, up, up, then notice that it’s at the right level. But before it can stop, it’s already too high. It starts turning the motor the other way, to go down, down at the same speed … it reaches the right level, but by the time it can stop, it’s too low.</p>
<p>This idea of <em>overshoot</em> will cause your elevator car to forever go up and down, bouncing up and down without ever settling on the green zone even once. This is because your motor only has one speed, and however much you overshoot going up, it’ll be exactly as much as you overshoot going down, and as much as you overshoot going up the next time.</p>
<p>For now … you might just have to rehire your elevator boy.</p>
<h2 id="the-hamster-hole-grows-deeper">The Hamster Hole Grows Deeper</h2>
<p>Are these the last of our problems standing in the way of a fully automated control system? Well, if you’ve noticed one trend in this post, it might be that as soon as we conquer one problem … many others inevitably pop up. Any simple solution to these that you can think of now will have its own share of issues and problems.</p>
<p>However, believe it or not, one day we will finally reach an end to this rat race and arrive at what is today known as the canonical “best” compromise for our system — the system that deals with all of the problems mentioned here, and nearly all of the problems that come up with the naive solutions of the ones we face now. The best we got. Not perfect — and not the best for many specific systems — but the best overall, general scheme for problems of this particular type.</p>
<p>I’m saying this to prevent you from being weary. We may have come a long way, and there may be much more to tackle, but fear not — there is a satisfying end to this hamster hole.</p>
<p>But first! How will we solve these fundamental problems — jittering and oscillation — of the bang–bang controller?</p>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>Technically, it is a modified version of the bang–bang controller with an option for “don’t do anything” — a “bang–bang–shh”. A true bang–bang controller would not have the “green light” option.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div><footer><hr><div class="copy-content"><p>Hi, thanks for reading! You can reach me via email at <a href="mailto:justin@jle.im" class="email">justin@jle.im</a>, or at twitter at <a href="https://twitter.com/mstk">@mstk</a>! This post and all others are published under the <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/">CC-BY-NC-ND 3.0</a> license. Corrections and edits via pull request are welcome and encouraged at <a href="https://github.com/mstksg/inCode">the source repository</a>.</p>
<p>If you feel inclined, or this post was particularly helpful for you, why not consider <a href="https://www.patreon.com/justinle/overview">supporting me on Patreon</a>, or a <a href="bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU">BTC donation</a>? :)</p></div><div class="clear"></div><ul class="entry-series"><li><div>This entry is a part of a series called <b>&quot;Introduction to Control Theory&quot;</b>.  Find the rest of the entries in this series at its <a href="https://blog.jle.im/entries/series/+introduction-to-control-theory.html" class="tag-a-series" title="A series of introductions to the subtle craft of controlling physical things
effectively.
"> series history</a>.</div></li></ul><ul class="tag-list"><li><a href="https://blog.jle.im/entries/tagged/control-theory.html" class="tag-a-tag">#control theory</a></li><li><a href="https://blog.jle.im/entries/category/@engineering.html" class="tag-a-category">@ENGINEERING</a></li><li><a href="https://blog.jle.im/entries/category/@ramblings.html" class="tag-a-category">@RAMBLINGS</a></li><li><a href="https://blog.jle.im/entries/series/+introduction-to-control-theory.html" class="tag-a-series">+Introduction to Control Theory</a></li></ul><aside class="social-buttons"><div class="addthis_toolbox addthis_default_style addthis-buttons"><a class="addthis_button_facebook_like" fb:like:layout="button_count"></a><a class="addthis_button_tweet"></a><a class="addthis_button_google_plusone" g:plusone:size="medium"></a><a class="addthis_counter addthis_pill_style"></a></div><div class="custom-social-buttons"><div class="custom-social-button"><a href="https://www.reddit.com/submit" onclick="window.location = &#39;https://www.reddit.com/submit?url=&#39;+ encodeURIComponent(window.location); return false"><img src="https://www.reddit.com/static/spreddit7.gif" alt="submit to reddit"></a></div></div></aside><nav class="next-prev-links"><ul><li class="prev-entry-link">&larr; <a href="https://blog.jle.im/entry/the-hamster-hotel-an-introduction-to-control-theory.html">The Hamster Hotel: An Introduction to Control Theory (Part 1)</a> (Previous)</li><li class="next-entry-link">(Next) <a href="https://blog.jle.im/entry/deploying-medium-to-large-haskell-apps-to-heroku.html">Deploying Medium to Large Haskell Apps to Heroku by Precompiling</a> &rarr;</li></ul></nav></footer></article><div class="post-entry"><div class="tile"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://blog.jle.im/entry/the-hamster-hotel-an-introduction-to-control-theory-2.html';
    this.page.identifier = 'control-intro-2';
};
(function() {
    var d = document, s = d.createElement('script');
    s.src = '//incode.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a><br></noscript><a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a></div></div></div></div></div><div id="footer-container"><div id="footer-content"><div class="tile"><div class="footer-copyright">&copy; 2020 Justin Le <span class="license-link">(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" class="license">CC-BY-NC-ND 3.0</a>)</span></div><div class="footer-follow social-follows"><ul class="social-follows-list"><li><ul class="social-follows-list-social"><li><a class="social-follow-twitter" title="Follow me on Twitter!" href="https://twitter.com/intent/user?user_id=mstk" onclick="window.open(
  &#39;http://twitter.com/intent/user?user_id=907281&#39;,
  &#39;facebook-share-dialog&#39;,
  &#39;width=550,height=520&#39;);
return false;
">Twitter</a></li><li><a class="social-follow-github" title="Fork me on Github!" href="https://github.com/mstksg">Github</a></li><li><a class="social-follow-twitch" title="Watch me on Twitch!" href="https://www.twitch.tv/justin_l">Twitch</a></li><li><a class="social-follow-patreon" title="Support me on Patreon!" href="https://www.patreon.com/justinle/overview">Patreon</a></li><li><a class="social-follow-gplus" title="Add me on Google+!" href="https://plus.google.com/+JustinLe">Google+</a></li><li><a class="social-follow-keybase" title="Track me on Keybase!" href="https://keybase.io/mstksg">Keybase</a></li><li><a class="social-follow-linkedin" title="Connect with me on LinkedIn!" href="https://linkedin.com/in/lejustin">LinkedIn</a></li><li><a class="social-follow-bitcoin" title="Donate via bitcoin!" href="bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU">Bitcoin</a></li></ul></li><li><ul class="social-follows-list-site"><li><a class="social-follow-rss" title="Subscribe to my RSS Feed!" href="http://feeds.feedburner.com/incodeblog">RSS</a></li><li><a class="social-follow-email" title="Subscribe to the mailing list!" href="https://feedburner.google.com/fb/a/mailverify?loc=en_US&amp;uri=incodeblog">Mailing list</a></li></ul></li></ul></div></div></div></div></body></html>