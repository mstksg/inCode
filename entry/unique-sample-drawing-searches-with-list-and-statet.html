<!DOCTYPE HTML>
<html><head><title>Unique sample drawing &amp; searches with List and StateT --- &quot;Send more money&quot; · in Code</title><meta name="description" content="Weblog of Justin Le, covering various adventures in programming and explorations in the worlds of computation physics, and knowledge.
"><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta name="flattr:id" content="3p9jqr"><meta property="og:site_name" content="in Code"><meta property="og:description" content="Nothing too crazy today, just a cute (basic/intermediate) haskell trick as a response to Mark Dominus’s excellent Universe of Discourse post on Easy exhaustive search with the list monad intended for people new or unfamiliar with haskell demonstrating the common “list monad as a constraint solver” approach that is standard fare for learning Haskell. I myself have literally done an entire series of blog posts on this usage. Mark’s use case however incorporates a bit of an extra pattern not typically discussed. The list monad is good for taking “independent samples” of things (looking at different samples from a list): ghci&gt; do x &lt;- &quot;abc&quot; y &lt;- &quot;abc&quot; z &lt;- &quot;abc&quot; return [x,y,z] [&quot;aaa&quot;,&quot;aab&quot;,&quot;aac&quot;,&quot;aba&quot;,&quot;abb&quot; ... ] However, what if you wanted to instead “draw” from a pool, and represent different drawings? Traditionally, the answer was something like: ghci&gt; do x &lt;- &quot;abc&quot; y &lt;- filter (/= x) &quot;abc&quot; z &lt;- filter (/= y) . filter (/= x) $ &quot;abc&quot; return [x,y,z] &quot;abc&quot;,&quot;acb&quot;,&quot;bac&quot;,&quot;bca&quot;,&quot;cab&quot;,&quot;cba&quot;] This is a little bit awkward…and it definitely gets a lot worse (O(n^2)) when you have more items. Also, it relies on an Eq constraint — what if our thing doesn’t have an Eq instance? And this also falls apart when our list contains duplicate items. If we had used &quot;aabc&quot; instead of &quot;abc&quot;, the result would be the same — despite having more &#39;a&#39;s to pick from!"><meta property="og:type" content="article"><meta property="og:title" content="Unique sample drawing &amp; searches with List and StateT --- &quot;Send more money&quot;"><meta property="og:image" content="https://blog.jle.im/img/site_logo.jpg"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://blog.jle.im/entry/unique-sample-drawing-searches-with-list-and-statet.html"><meta name="twitter:card" content="summary"><meta name="twitter:creator:id" content="mstk"><link rel="author" href="https://plus.google.com/107705320197444500140"><link rel="alternate" type="application/rss+xml" title="in Code (RSS Feed)" href="http://feeds.feedburner.com/incodeblog"><link rel="canonical" href="https://blog.jle.im/entry/unique-sample-drawing-searches-with-list-and-statet.html"><link href="https://blog.jle.im/favicon.ico" rel="shortcut icon"><link href="https://blog.jle.im/css/toast.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/font.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/main.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/page/entry.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/pygments.css" rel="stylesheet" type="text/css"><script type="text/javascript">var page_data = {};
var disqus_shortname='incode';
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-443711-8', 'jle.im');
ga('send', 'pageview');
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script><script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5234d67a6b68dcd4"></script><script type="text/javascript" src="https://blog.jle.im/js/page/entry_toc.js"></script><script type="text/javascript" src="https://blog.jle.im/js/disqus_count.js"></script><script type="text/javascript" src="https://blog.jle.im/js/social.js"></script><script type="text/javascript" src="https://blog.jle.im/js/jquery/jquery.toc.js"></script><script type="text/javascript" src="https://blog.jle.im/purescript/entry.js"></script></head><body><div id="fb-root"><script>(function(d, s, id) {
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) return;
 js = d.createElement(s); js.id = id;
 js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=641852699171929";
 fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script></div><div id="header-container"><div id="navbar-container" class="tile"><nav id="navbar-content"><div class="nav-info"><h1 class="site-title"><a href="https://blog.jle.im/" class="nav-title">in Code</a></h1><span class="nav-author">Justin Le</span></div><ul class="nav-links"><li><a href="https://blog.jle.im/">home</a></li><li><a href="https://blog.jle.im/entries.html">archives</a></li><li><a href="https://cv.jle.im">cv</a></li><div class="clear"></div></ul></nav></div><div id="header-content"></div></div><div id="body-container" class="container"><div id="main-container" class="grid"><div class="entry-section unit span-grid" role="main"><article class="tile article"><header><h1 id="title">Unique sample drawing &amp; searches with List and StateT --- &quot;Send more money&quot;</h1><p class="entry-info">by <a class="author" href="https://blog.jle.im/">Justin Le</a><span class="info-separator"> &diams; </span><time datetime="2015-04-24T11:05:56Z" pubdate="" class="pubdate">Friday April 24, 2015</time></p><p><span class="source-info"><a class="source-link" href="https://github.com/mstksg/inCode/tree/master/copy/entries/send-more-money.md">Source</a><span class="info-separator"> &diams; </span><a class="source-link" href="https://github.com/mstksg/inCode/tree/gh-pages/entry/unique-sample-drawing-searches-with-list-and-statet.md">Markdown</a><span class="info-separator"> &diams; </span><a class="source-link" href="https://blog.jle.im/entry/unique-sample-drawing-searches-with-list-and-statet.tex">LaTeX</a><span class="info-separator"> &diams; </span></span>Posted in <a href="https://blog.jle.im/entries/category/@haskell.html" class="tag-a-category" title="Functional, pure, non-strict, statically and strongly typed, natively
compiled...really just the king of great languages.
">Haskell</a>, <a href="https://blog.jle.im/entries/category/@tutorials.html" class="tag-a-category" title="Technical tutorials/walkthroughs on specific programming processes and problems
that I&#39;ve struggled through in the past.
">Tutorials</a><span class="info-separator"> &diams; </span><a class="comment-link" href="#disqus_thread">Comments</a></p></header><hr><aside class="contents-container"><h5 id="contents-header">Contents</h5><div id="toc"></div></aside><div class="main-content copy-content"><p>Nothing too crazy today, just a cute (basic/intermediate) haskell trick as a response to Mark Dominus’s excellent <a href="http://blog.plover.com">Universe of Discourse</a> post on <a href="http://blog.plover.com/prog/haskell/monad-search.html">Easy exhaustive search with the list monad</a> intended for people new or unfamiliar with haskell demonstrating the common “list monad as a constraint solver” approach that is standard fare for learning Haskell. I myself have literally done <a href="http://blog.jle.im/entries/series/+monadplus-success-failure-monads">an entire series of blog posts</a> on this usage.</p>
<p>Mark’s use case however incorporates a bit of an extra pattern not typically discussed. The list monad is good for taking “independent samples” of things (looking at different samples from a list):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="kw">do</span> x <span class="ot">&lt;-</span> <span class="st">&quot;abc&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>         y <span class="ot">&lt;-</span> <span class="st">&quot;abc&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>         z <span class="ot">&lt;-</span> <span class="st">&quot;abc&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span> [x,y,z]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>[<span class="st">&quot;aaa&quot;</span>,<span class="st">&quot;aab&quot;</span>,<span class="st">&quot;aac&quot;</span>,<span class="st">&quot;aba&quot;</span>,<span class="st">&quot;abb&quot;</span> <span class="op">...</span> ]</span></code></pre></div>
<p>However, what if you wanted to instead “draw” from a pool, and represent different drawings? Traditionally, the answer was something like:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="kw">do</span> x <span class="ot">&lt;-</span> <span class="st">&quot;abc&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>         y <span class="ot">&lt;-</span> <span class="fu">filter</span> (<span class="op">/=</span> x) <span class="st">&quot;abc&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         z <span class="ot">&lt;-</span> <span class="fu">filter</span> (<span class="op">/=</span> y) <span class="op">.</span> <span class="fu">filter</span> (<span class="op">/=</span> x) <span class="op">$</span> <span class="st">&quot;abc&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span> [x,y,z]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;abc&quot;</span>,<span class="st">&quot;acb&quot;</span>,<span class="st">&quot;bac&quot;</span>,<span class="st">&quot;bca&quot;</span>,<span class="st">&quot;cab&quot;</span>,<span class="st">&quot;cba&quot;</span>]</span></code></pre></div>
<p>This is a little bit awkward…and it definitely gets a lot worse (<span class="math inline">\(O(n^2)\)</span>) when you have more items. Also, it relies on an <code>Eq</code> constraint — what if our thing doesn’t have an <code>Eq</code> instance? And this also falls apart when our list contains duplicate items. If we had used <code>"aabc"</code> instead of <code>"abc"</code>, the result would be the same — despite having more <code>'a'</code>s to pick from!</p>
<p><strong>Important note:</strong> After writing this article, I found out that Douglas Auclair in <a href="https://wiki.haskell.org/wikiupload/6/6a/TMR-Issue11.pdf">11th issue of the Monad Reader</a> solved this exact same problem with pretty much the exact same approach. (Oops!) If you want to do further reading, check it out! :D</p>
<h2 id="statet">StateT</h2>
<p>There’s a type in the <em>transformers</em> library that provides a very useful monad instance:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">StateT</span> s m a <span class="ot">=</span> <span class="dt">StateT</span> (s <span class="ot">-&gt;</span> m (a, s))</span></code></pre></div>
<p>A <code>StateT s m a</code> is a function that takes an initial state <code>s</code> and returns a result <code>a</code> with a modified state…in the context of <code>m</code>.</p>
<p>Specialize for <code>m ~ []</code> and we get</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">StateT</span> s [] a <span class="ot">=</span> <span class="dt">StateT</span> (s <span class="ot">-&gt;</span> [(a, s)])</span></code></pre></div>
<p>Which is basically describing a function from a initial state to a list of <em>ways you can modify the state</em>, and different results from each one. It returns a list of “all ways you can mutate this state”.</p>
<p>For example,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ot">foo ::</span> <span class="dt">StateT</span> <span class="dt">Int</span> [] <span class="dt">Bool</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">=</span> <span class="dt">StateT</span> <span class="op">$</span> \x <span class="ot">-&gt;</span> [(<span class="fu">even</span> x, x<span class="op">+</span><span class="dv">1</span>), (<span class="fu">odd</span> x, x<span class="op">-</span><span class="dv">1</span>), (x <span class="op">&gt;</span> <span class="dv">0</span>, <span class="fu">negate</span> x)]</span></code></pre></div>
<p>So <code>foo</code> takes a number, <code>x</code>, and says, “here are three ways we might proceed from having this number. We can return whether or not it’s even, in which case the new state is <code>x+1</code>…we can return whether or not it’s odd, in which case the new state is <code>x-1</code>….or we can return whether or not it’s positive, in which case the new state is <code>negate x</code>”</p>
<p>What the monad instance does is that it allows you to “chain” forks, and go along different forks, and gather together “all possible forks” you could have taken. At the end, it outputs all possible forks. So if you did <code>foo &gt;&gt; foo</code>, there’d be nine results — one result for when you took the first route (the <code>x+1</code>) twice, one for when you took the first and then the second (<code>x-1</code>), one for when you took the first and the third….and the second and the first…etc., etc.</p>
<h3 id="monadplus">MonadPlus</h3>
<p>One other tool we have at our disposal is <code>guard</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ot">guard ::</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> <span class="dt">StateT</span> <span class="dt">Int</span> [] ()</span></code></pre></div>
<p>which is a <code>StateT</code> action that says “kill this current branch if given <code>False</code>, or go on if given <code>True</code>”</p>
<h2 id="the-problem">The Problem</h2>
<p>The problem, as stated, was to find distinct digits for each letter to solve:</p>
<pre><code>    S E N D
+   M O R E
-----------
  M O N E Y</code></pre>
<p>So <code>SEND</code> is a four-digit number, <code>MORE</code> is a four-digit number, and <code>MONEY</code> is a five-digit number that is the sum of the two. The first digit of <code>MONEY</code> has to be the first digit of <code>MORE</code>, the last digit of <code>MORE</code> has to be the second digit of <code>SEND</code>, etc.</p>
<p>The previous approach was done using the entire “pick from all possibilities…except for the ones already chosen”, using <code>(/=)</code> and filtering over all of the things seen vs all of the things to pick from.</p>
<p>However, we can abstract over “picking dependently from a sample” by defining a function called <code>select</code>, which really should be in the base libraries but isn’t for some reason:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/misc/send-more-money.hs#L7-L9</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ot">select ::</span> [a] <span class="ot">-&gt;</span> [(a, [a])]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>select []     <span class="ot">=</span> []</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>select (x<span class="op">:</span>xs) <span class="ot">=</span> (x,xs) <span class="op">:</span> [(y,x<span class="op">:</span>ys) <span class="op">|</span> (y,ys) <span class="ot">&lt;-</span> select xs]</span></code></pre></div>
<p>(Implementation thanks to Cale, who has fought valiantly yet fruitlessly to get this into base for many years.)</p>
<p><code>select</code> will take a list <code>[a]</code> and return a list of different “selected” <code>a</code>s, with the rest of the list, too:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> select <span class="st">&quot;abcd&quot;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>[(<span class="ch">&#39;a&#39;</span>,<span class="st">&quot;bcd&quot;</span>),(<span class="ch">&#39;b&#39;</span>,<span class="st">&quot;acd&quot;</span>),(<span class="ch">&#39;c&#39;</span>,<span class="st">&quot;abd&quot;</span>),(<span class="ch">&#39;d&#39;</span>,<span class="st">&quot;abc&quot;</span>)]</span></code></pre></div>
<p>But, hey…does the type signature of <code>select</code> look like anything familiar?</p>
<p>It looks <em>exactly</em> like something that <code>StateT</code> is supposed to describe! Give an initial state (<code>[a]</code>), and returns a list of all possible ways to “mutate” that state (by removing one element from the state), and a result from each mutation (the removed element).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">StateT</span><span class="ot"> select ::</span> <span class="dt">StateT</span> [a] [] a</span></code></pre></div>
<p>And armed with this…we have all we need</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/misc/send-more-money.hs#L3-L35</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Monad</span>             (guard, mfilter)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Monad.Trans.State</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.List</span>                 (foldl&#39;)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ot">asNumber ::</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>asNumber <span class="ot">=</span> foldl&#39; (\t o <span class="ot">-&gt;</span> t<span class="op">*</span><span class="dv">10</span> <span class="op">+</span> o) <span class="dv">0</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">print</span> <span class="op">.</span> <span class="fu">flip</span> evalStateT [<span class="dv">0</span><span class="op">..</span><span class="dv">9</span>] <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    e <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    o <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    guard <span class="op">$</span> s <span class="op">/=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> m <span class="op">/=</span> <span class="dv">0</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> send  <span class="ot">=</span> asNumber [s,e,n,d]</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        more  <span class="ot">=</span> asNumber [m,o,r,e]</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        money <span class="ot">=</span> asNumber [m,o,n,e,y]</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    guard <span class="op">$</span> send <span class="op">+</span> more <span class="op">==</span> money</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (send, more, money)</span></code></pre></div>
<p>Remember, <code>StateT</code> here operates with an underlying state of <code>[Int]</code>, a list of numbers not yet picked. <code>StateT select</code> picks one of these numbers, and modifies the state to now only include the items that were not picked. So every time you sequence <code>StateT select</code>, <code>select</code> draws from a smaller and smaller pool of numbers, and makes the state list smaller and smaller. What sequencing <code>StateT</code> does is allow us to explore <em>all</em> of the possible ways we could pick and modify state, all at once. Using <code>guard</code>, we then “close off” and kill off the paths that don’t end up how we’d like.</p>
<p><code>asNumber</code> takes a list like <code>[1,2,3]</code> and turns it into the number <code>123</code>; credit to the source blog.</p>
<p>And, to test it out…</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ghc <span class="at">-O2</span> send-more-money.hs</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./send-more-money</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># [(9567,1085,10652)]</span></span></code></pre></div>
<p>It returns the one and only solution, <code>SEND = 9567</code>, <code>MORE = 1085</code>, and <code>MONEY = 10652</code>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="note">
<p><strong>Aside</strong></p>
<p>We can make things a little bit more efficient with minimal cost in expressiveness. But not that it matters…the original version runs fast already.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/misc/send-more-money.hs#L38-L59</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ot">select&#39; ::</span> [a] <span class="ot">-&gt;</span> [(a,[a])]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>select&#39; <span class="ot">=</span> go []</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>   go xs [] <span class="ot">=</span> []</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>   go xs (y<span class="op">:</span>ys) <span class="ot">=</span> (y,xs<span class="op">++</span>ys) <span class="op">:</span> go (y<span class="op">:</span>xs) ys</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ot">main&#39; ::</span> <span class="dt">IO</span> ()</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>main&#39; <span class="ot">=</span> <span class="fu">print</span> <span class="op">.</span> <span class="fu">flip</span> evalStateT [<span class="dv">0</span><span class="op">..</span><span class="dv">9</span>] <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> mfilter (<span class="op">/=</span> <span class="dv">0</span>) <span class="op">$</span> <span class="dt">StateT</span> select&#39;</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> mfilter (<span class="op">/=</span> <span class="dv">0</span>) <span class="op">$</span> <span class="dt">StateT</span> select&#39;</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    e <span class="ot">&lt;-</span> <span class="dt">StateT</span> select&#39;</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="dt">StateT</span> select&#39;</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="dt">StateT</span> select&#39;</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    o <span class="ot">&lt;-</span> <span class="dt">StateT</span> select&#39;</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="dt">StateT</span> select&#39;</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="dt">StateT</span> select&#39;</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> send  <span class="ot">=</span> asNumber [s,e,n,d]</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        more  <span class="ot">=</span> asNumber [m,o,r,e]</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        money <span class="ot">=</span> asNumber [m,o,n,e,y]</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    guard <span class="op">$</span> send <span class="op">+</span> more <span class="op">==</span> money</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (send, more, money)</span></code></pre></div>
<p>This is a more performant version of <code>select</code> <a href="http://chimera.labs.oreilly.com/books/1230000000929/pr01.html">courtesy of Simon Marlow</a> that doesn’t preserve the order of the “rest of the elements”.</p>
<p>Also, we use <code>mfilter</code> to “eliminate bad <code>s</code> and <code>m</code>s” right off the bat, before having to pick any more things. <code>mfilter</code> can be thought of as “killing the fork immediately” if the action doesn’t satisfy the predicate. If the <code>s</code> picked doesn’t match <code>(/= 0)</code>, then the entire branch/fork is immediately ruled invalid.</p>
</div>
<p>By the way, isn’t it neat that it does all of this in “constant space”? It just keeps track of the output list, but the actual search processes is in constant space. You don’t need to keep track of all <code>10!</code> combinations in memory at once. Hooray laziness!</p>
<h2 id="other-applications">Other Applications</h2>
<p>Using <code>select</code> and <code>StateT</code>, we can do a lot of things involving picking from a sample, or permutations. Anything that you used to awkwardly do by using filter not-equal-to’s can work now. You can do things like drawing from a deck:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ot">pokerGame ::</span> [<span class="dt">Ordering</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>pokerGame <span class="ot">=</span> <span class="fu">flip</span> evalStateT [<span class="dv">0</span><span class="op">..</span><span class="dv">51</span>] <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    p2Hand <span class="ot">&lt;-</span> replicateM <span class="dv">5</span> (<span class="dt">StateT</span> select)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    p1Hand <span class="ot">&lt;-</span> replicateM <span class="dv">5</span> (<span class="dt">StateT</span> select)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="op">$</span> pokerCompare p1Hand p2Hand</span></code></pre></div>
<p>Which would draw five distinct cards from a deck of <code>[0..51]</code>, and return who won for each draw (assuming you had a suitable <code>pokerCompare :: [Card] -&gt; [Card] -&gt; Ordering</code>). Note that if you use <code>runStateT</code>, you’d get the results (the winner), <em>as well as</em> the leftover cards in the deck for each path!</p>
<p>You can even combine the two sorts of drawings — sampling independently (like rolling dice) using <code>lift</code>, and drawing from an underlying deck. For example, you might encode some game logic from a board game like monopoly:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>combo <span class="ot">=</span> <span class="fu">flip</span> evalStateT initialDeck <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    roll <span class="ot">&lt;-</span> lift [<span class="dv">1</span><span class="op">..</span><span class="dv">6</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    draw <span class="ot">&lt;-</span> <span class="dt">StateT</span> select</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>Whenever you want a dice roll, use <code>lift [1..6]</code>…and whenever you want to draw from the deck, use <code>StateT select</code>.</p>
<p>What you get in the end, remember, is a list of “all possible paths”. You’ll get a list of every possible result from all of your different rolling and drawing choices.</p>
<p>Happy Haskelling!</p>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>For some reason this runs pretty slowly if you use <code>runghc</code>/<code>runHaskell</code>, but it runs in the blink of an eye when you actually compile it (and especially with optimizations on). The difference is pretty striking…and I don’t really know what’s going on here, to be honest. If anyone does know a good explanation, I’d love to hear it :)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div><footer><hr><div class="copy-content"><p>Hi, thanks for reading! You can reach me via email at <a href="mailto:justin@jle.im" class="email">justin@jle.im</a>, or at twitter at <a href="https://twitter.com/mstk">@mstk</a>! This post and all others are published under the <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/">CC-BY-NC-ND 3.0</a> license. Corrections and edits via pull request are welcome and encouraged at <a href="https://github.com/mstksg/inCode">the source repository</a>.</p>
<p>If you feel inclined, or this post was particularly helpful for you, why not consider <a href="https://www.patreon.com/justinle/overview">supporting me on Patreon</a>, or a <a href="bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU">BTC donation</a>? :)</p></div><div class="clear"></div><ul class="entry-series"></ul><ul class="tag-list"><li><a href="https://blog.jle.im/entries/tagged/haskell.html" class="tag-a-tag">#haskell</a></li><li><a href="https://blog.jle.im/entries/tagged/monads.html" class="tag-a-tag">#monads</a></li><li><a href="https://blog.jle.im/entries/category/@haskell.html" class="tag-a-category">@HASKELL</a></li><li><a href="https://blog.jle.im/entries/category/@tutorials.html" class="tag-a-category">@TUTORIALS</a></li></ul><aside class="social-buttons"><div class="addthis_toolbox addthis_default_style addthis-buttons"><a class="addthis_button_facebook_like" fb:like:layout="button_count"></a><a class="addthis_button_tweet"></a><a class="addthis_button_google_plusone" g:plusone:size="medium"></a><a class="addthis_counter addthis_pill_style"></a></div><div class="custom-social-buttons"><div class="custom-social-button"><a href="https://www.reddit.com/submit" onclick="window.location = &#39;https://www.reddit.com/submit?url=&#39;+ encodeURIComponent(window.location); return false"><img src="https://www.reddit.com/static/spreddit7.gif" alt="submit to reddit"></a></div></div></aside><nav class="next-prev-links"><ul><li class="prev-entry-link">&larr; <a href="https://blog.jle.im/entry/auto-a-todo-gui-application-with-auto-on.html">Auto: A Todo GUI application with Auto (on GHCJS, etc.)</a> (Previous)</li><li class="next-entry-link">(Next) <a href="https://blog.jle.im/entry/fixed-length-vector-types-in-haskell-2015.html">Fixed-Length Vector Types in Haskell, 2015</a> &rarr;</li></ul></nav></footer></article><div class="post-entry"><div class="tile"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://blog.jle.im/entry/unique-sample-drawing-searches-with-list-and-statet.html';
    this.page.identifier = 'send-more-money';
};
(function() {
    var d = document, s = d.createElement('script');
    s.src = '//incode.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a><br></noscript><a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a></div></div></div></div></div><div id="footer-container"><div id="footer-content"><div class="tile"><div class="footer-copyright">&copy; 2020 Justin Le <span class="license-link">(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" class="license">CC-BY-NC-ND 3.0</a>)</span></div><div class="footer-follow social-follows"><ul class="social-follows-list"><li><ul class="social-follows-list-social"><li><a class="social-follow-twitter" title="Follow me on Twitter!" href="https://twitter.com/intent/user?user_id=mstk" onclick="window.open(
  &#39;http://twitter.com/intent/user?user_id=907281&#39;,
  &#39;facebook-share-dialog&#39;,
  &#39;width=550,height=520&#39;);
return false;
">Twitter</a></li><li><a class="social-follow-github" title="Fork me on Github!" href="https://github.com/mstksg">Github</a></li><li><a class="social-follow-twitch" title="Watch me on Twitch!" href="https://www.twitch.tv/justin_l">Twitch</a></li><li><a class="social-follow-patreon" title="Support me on Patreon!" href="https://www.patreon.com/justinle/overview">Patreon</a></li><li><a class="social-follow-gplus" title="Add me on Google+!" href="https://plus.google.com/+JustinLe">Google+</a></li><li><a class="social-follow-keybase" title="Track me on Keybase!" href="https://keybase.io/mstksg">Keybase</a></li><li><a class="social-follow-linkedin" title="Connect with me on LinkedIn!" href="https://linkedin.com/in/lejustin">LinkedIn</a></li><li><a class="social-follow-bitcoin" title="Donate via bitcoin!" href="bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU">Bitcoin</a></li></ul></li><li><ul class="social-follows-list-site"><li><a class="social-follow-rss" title="Subscribe to my RSS Feed!" href="http://feeds.feedburner.com/incodeblog">RSS</a></li><li><a class="social-follow-email" title="Subscribe to the mailing list!" href="https://feedburner.google.com/fb/a/mailverify?loc=en_US&amp;uri=incodeblog">Mailing list</a></li></ul></li></ul></div></div></div></div></body></html>