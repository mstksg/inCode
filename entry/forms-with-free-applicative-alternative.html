<!DOCTYPE HTML>
<html><head><title>Abstract Validating Forms with Free Applicative/Alternative · in Code</title><meta name="description" content="Weblog of Justin Le, covering various adventures in programming and explorations in the worlds of computation physics, and knowledge.
"><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta name="flattr:id" content="3p9jqr"><meta property="og:site_name" content="in Code"><meta property="og:description" content="One tool I’ve been finding myself using a lot recently is the Free Applicative (and Free Alternative), from the free package. Free Monads are great, and they’re often used to implement the “interpreter pattern” (although I personally prefer operational, as I wrote about in a previous blog post, for that design pattern). However, Free Applicatives are really a completely different type of thing, and the use cases for each are pretty disjoint. If I had to make a general statement, I’ll say that free monads are especially good at representing the idea of abstract sequential generators (sequences that are chained dependently one after the other), and that free applicatives are especially good at representing the idea of abstract parallel generators (things operating in parallel without any interconnected data dependencies). For this post, I’ll be talking about using the Free Applicative Ap (and the Free Alternative, Alt) with an abstract representation of a form element in order to generate an abstract representation of a validating form, and leveraging this representation to realize these forms in terminal IO, JSON/YAML, PDF documents, and even on the browser using ghcjs and miso."><meta property="og:type" content="article"><meta property="og:title" content="Abstract Validating Forms with Free Applicative/Alternative"><meta property="og:image" content="https://blog.jle.im/img/site_logo.jpg"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://blog.jle.im/entry/forms-with-free-applicative-alternative.html"><meta name="twitter:card" content="summary"><meta name="twitter:creator:id" content="mstk"><link rel="author" href="https://plus.google.com/107705320197444500140"><link rel="alternate" type="application/rss+xml" title="in Code (RSS Feed)" href="http://feeds.feedburner.com/incodeblog"><link rel="canonical" href="https://blog.jle.im/entry/forms-with-free-applicative-alternative.html"><link href="https://blog.jle.im/favicon.ico" rel="shortcut icon"><link href="https://blog.jle.im/css/toast.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/font.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/main.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/page/entry.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/pygments.css" rel="stylesheet" type="text/css"><script type="text/javascript">var page_data = {};
var disqus_shortname='incode';
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-443711-8', 'jle.im');
ga('send', 'pageview');
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script><script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5234d67a6b68dcd4"></script><script type="text/javascript" src="https://blog.jle.im/js/page/entry_toc.js"></script><script type="text/javascript" src="https://blog.jle.im/js/disqus_count.js"></script><script type="text/javascript" src="https://blog.jle.im/js/social.js"></script><script type="text/javascript" src="https://blog.jle.im/js/jquery/jquery.toc.js"></script><script type="text/javascript" src="https://blog.jle.im/purescript/entry.js"></script></head><body><div id="fb-root"><script>(function(d, s, id) {
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) return;
 js = d.createElement(s); js.id = id;
 js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=641852699171929";
 fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script></div><div id="header-container"><div id="navbar-container" class="tile"><nav id="navbar-content"><div class="nav-info"><h1 class="site-title"><a href="https://blog.jle.im/" class="nav-title">in Code</a></h1><span class="nav-author">Justin Le</span></div><ul class="nav-links"><li><a href="https://blog.jle.im/">home</a></li><li><a href="https://blog.jle.im/entries.html">archives</a></li><li><a href="https://cv.jle.im">cv</a></li><div class="clear"></div></ul></nav></div><div id="header-content"></div></div><div id="body-container" class="container"><div id="main-container" class="grid"><div class="entry-section unit span-grid" role="main"><article class="tile article"><header><div class="unposted-banner">Unposted entry</div><h1 id="title">Abstract Validating Forms with Free Applicative/Alternative</h1><p class="entry-info">by <a class="author" href="https://blog.jle.im/">Justin Le</a></p><p><span class="source-info"><a class="source-link" href="https://github.com/mstksg/inCode/tree/master/copy/entries/free-applicative-forms.md">Source</a><span class="info-separator"> &diams; </span><a class="source-link" href="https://github.com/mstksg/inCode/tree/gh-pages/entry/forms-with-free-applicative-alternative.md">Markdown</a><span class="info-separator"> &diams; </span><a class="source-link" href="https://blog.jle.im/entry/forms-with-free-applicative-alternative.tex">LaTeX</a><span class="info-separator"> &diams; </span></span>Posted in <a href="https://blog.jle.im/entries/category/@haskell.html" class="tag-a-category" title="Functional, pure, non-strict, statically and strongly typed, natively
compiled...really just the king of great languages.
">Haskell</a><span class="info-separator"> &diams; </span><a class="comment-link" href="#disqus_thread">Comments</a></p></header><hr><aside class="contents-container"><h5 id="contents-header">Contents</h5><div id="toc"></div></aside><div class="main-content copy-content"><p>One tool I’ve been finding myself using a lot recently is the <em>Free Applicative</em> (and <em>Free Alternative</em>), from the <em><a href="https://hackage.haskell.org/package/free">free</a></em> package.</p>
<p>Free Monads are great, and they’re often used to implement the “interpreter pattern” (although I personally prefer <em><a href="https://hackage.haskell.org/package/operational">operational</a></em>, as I wrote about in a <a href="https://blog.jle.im/entry/interpreters-a-la-carte-duet.html">previous blog post</a>, for that design pattern). However, Free Applicatives are really a completely different type of thing, and the use cases for each are pretty disjoint.</p>
<p>If I had to make a general statement, I’ll say that free monads are especially good at representing the idea of abstract <em>sequential</em> generators (sequences that are chained dependently one after the other), and that free applicatives are especially good at representing the idea of abstract <em>parallel</em> generators (things operating in parallel without any interconnected data dependencies).</p>
<p>For this post, I’ll be talking about using the Free Applicative <code>Ap</code> (and the Free Alternative, <code>Alt</code>) with an abstract representation of a form element in order to generate an abstract representation of a validating form, and leveraging this representation to realize these forms in terminal IO, JSON/YAML, PDF documents, and even on the browser using <em>ghcjs</em> and <em><a href="https://hackage.haskell.org/package/miso">miso</a></em>.</p>
<h2 id="overview">Overview</h2>
<p>The general approach to utilizing the Free Applicative for this type of application is to start with some Functor <code>F</code> (<code>F a</code> represents the act of generating a value of type <code>a</code>). Once you throw <code>F</code> into <code>Ap</code> to get <code>Ap F</code>, you now are able to <em>combine <code>F</code>s in parallel</em> with <code>&lt;$&gt;</code>, <code>&lt;*&gt;</code>, <code>liftA2</code>, <code>sequence</code>, <code>traverse</code>, etc., even though <code>F</code> normally could not support such combinations. Then, finally, you have the ability to provide a concrete generator function <code>forall a. Applicative f =&gt; F a -&gt; f a</code> (given <code>F a</code>, return an actual generator of <code>a</code>s in some <code>Applicative</code>), and the magic of the Free Applicative will go in and actually run all of your combined <code>F</code> actions “in parallel”. The trick is that, with the same value of <code>Ap F a</code>, you can <em>run multiple different concrete generators</em> on it, so you can realize <code>Ap F</code> in multiple different contexts and situations, adapting it for whatever you need.</p>
<p>So, in our case, we’re going to be making a Functor representing a form element:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">FormElem</span> a</span></code></pre></div>
<p>Where a <code>FormElem a</code> represents a <em>single form element</em> producing an <code>a</code>. A <code>FormElem Int</code>, for instance, will represent a single form element producing an <code>Int</code>.</p>
<p>Then, we can create, using <a href="https://hackage.haskell.org/package/free/docs/Control-Applicative-Free.html">Ap</a>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Form</span> <span class="ot">=</span> <span class="dt">Ap</span> <span class="dt">FormElem</span></span></code></pre></div>
<p>And now we have a type where <code>Form a</code> is <em>whole form with multiple elements</em> that all work together to produce a value of type <code>a</code>!</p>
<p>For example, if we had <code>intElem :: FormElem Int</code>, then <code>liftAp intElem :: Form Int</code>, a single-item form that makes an <code>Int</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">intElem ::</span> <span class="dt">FormElem</span> <span class="dt">Int</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ot">intForm ::</span> <span class="dt">Form</span> <span class="dt">Int</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>intForm <span class="ot">=</span> liftAp intElem</span></code></pre></div>
<p>We can now do all of our Applicativey stuff with it, to generate, for instance, a form with two items that produces their sum:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- | A form with two elements, whose overal result is the sum of the two</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- element&#39;s inputs</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ot">addingForm ::</span> <span class="dt">Form</span> <span class="dt">Int</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>addingForm <span class="ot">=</span> (<span class="op">+</span>) <span class="op">&lt;$&gt;</span> intForm <span class="op">&lt;*&gt;</span> intForm</span></code></pre></div>
<p>Or, we can even generate a form with many ‘Int’ elements, and produce a list of all of their items:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- | A form with five elements, whose result is a list of all of their inputs</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ot">bunchaInts ::</span> <span class="dt">Form</span> [<span class="dt">Int</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>bunchaInts <span class="ot">=</span> replicateM <span class="dv">5</span> intForm</span></code></pre></div>
<p>Of course, in real life, forms usually have <em>Alternative</em> instances, which allows you to use <code>&lt;|&gt;</code> to “chose” a result between potentially invalid entries, and also create “optional” entries for free using <code>optional</code>. To do that, we actually use the <em>Free Alternative</em>, <em><a href="https://hackage.haskell.org/package/free/docs/Control-Alternative-Free-Final.html">Alt</a></em>, instead:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Form</span> <span class="ot">=</span> <span class="dt">Alt</span> <span class="dt">FormElem</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ot">intForm ::</span> <span class="dt">Form</span> <span class="dt">Int</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>intForm <span class="ot">=</span> liftAlt intElem</span></code></pre></div>
<p>And now we get the ability to represent forms with multiple options with <code>&lt;|&gt;</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ot">boolForm ::</span> <span class="dt">Form</span> <span class="dt">Bool</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- | A form with two elements (one producing an &#39;Int&#39; and one producing a</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- &#39;Bool&#39;), where the result is &#39;Either Int Bool&#39; -- a &quot;the first or the</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- second&quot;.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ot">eitherInt ::</span> <span class="dt">Form</span> (<span class="dt">Either</span> <span class="dt">Int</span> <span class="dt">Bool</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>eitherInt <span class="ot">=</span> (<span class="dt">Left</span> <span class="op">&lt;$&gt;</span> intForm) <span class="op">&lt;|&gt;</span> (<span class="dt">Right</span> <span class="op">&lt;$&gt;</span> boolForm)</span></code></pre></div>
<p>From multiple forms, with <code>choice</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ot">stringForm ::</span> <span class="dt">Form</span> <span class="dt">String</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- | A form with five elements -- an &#39;Int&#39; element, a &#39;Bool&#39; element, and three</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- &#39;String&#39; elements.  The result is the first of the four options to succeed.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ot">oneOfMany ::</span> <span class="dt">Form</span> <span class="dt">String</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>oneOfMany <span class="ot">=</span> choice [ <span class="fu">show</span> <span class="op">&lt;$&gt;</span> intForm</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                   , <span class="fu">show</span> <span class="op">&lt;$&gt;</span> boolForm</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                   , stringForm</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                   , (<span class="op">++</span>) <span class="op">&lt;$&gt;</span> stringForm <span class="op">&lt;*&gt;</span> stringForm</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                   ]</span></code></pre></div>
<p>And create “optional” entries:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- | A form with a single &#39;Int&#39; element that returns a &#39;Maybe Int&#39;, because</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- it&#39;s optional.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ot">optionalInt ::</span> <span class="dt">Form</span> (<span class="dt">Maybe</span> <span class="dt">Int</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>optionalInt <span class="ot">=</span> optional intForm</span></code></pre></div>
<p>We get all of these capabilities <em>for free</em>! All we did was <em>define a single form element</em>. Our form element type doesn’t have have any concept of combining with other elements or of being able to choose between different elements or of having optional results. Then, <code>Alt</code> gives us the ability to combine them with <code>&lt;*&gt;</code>/<code>&lt;$&gt;</code>, create optional form items with <code>optional</code>, and create multiple form options with <code>&lt;|&gt;</code>!</p>
<h2 id="our-types">Our Types</h2>
<h3 id="form-element">Form Element</h3>
<p>Our form elements will all have monomorphic base element paired with a “parser”, a description, and an identifier.</p>
<p>To start off, we’ll make a GADT representing a concrete element, as well as what is required to actually represent it for the user to interact with:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L19-L27</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Elem</span><span class="ot"> ::</span> <span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- | Text field</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">EText</span><span class="ot">   ::</span> <span class="dt">Elem</span> <span class="dt">String</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- | Numberic field</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ENumber</span><span class="ot"> ::</span> <span class="dt">Elem</span> <span class="dt">Scientific</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- | Select box, with list of options to display</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ESelect</span><span class="ot"> ::</span> [<span class="dt">String</span>] <span class="ot">-&gt;</span> <span class="dt">Elem</span> (<span class="dt">Maybe</span> <span class="dt">Int</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- | Check box, with the labels to attach to on/off states</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ECheck</span><span class="ot">  ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Elem</span> <span class="dt">Bool</span></span></code></pre></div>
<p>We tag the <code>Elem</code> with a type representing the element’s <em>native</em> output. So an <code>Elem String</code> is an element that natively/naively outputs a <code>String</code> (like a text input), an <code>Elem Bool</code> is an element that natively/naively outputs a <code>Bool</code> (like check box), etc.</p>
<p>Each native <code>Elem</code> contains the information necessary to render it – so we have:</p>
<ul>
<li><code>EText</code>, natively outputting a <code>String</code>.</li>
<li><code>ENumber</code>, natively outputting a number (<code>Scientific</code>).</li>
<li><code>ESelect</code>, a drop-down menu, a list of strings to show as items, natively outputting <code>Maybe Int</code> (“maybe” a selected index)</li>
<li><code>ECheck</code>, a check box containing labels for its on and off positions, natively outputting a <code>Bool</code>.</li>
</ul>
<p>And then we our representation of a generator for a single form element output:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L29-L35</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">FormElem</span><span class="ot"> ::</span> <span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FE</span><span class="ot"> ::</span> {<span class="ot"> feElem  ::</span> <span class="dt">Elem</span> b</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>          ,<span class="ot"> feParse ::</span> b <span class="ot">-&gt;</span> <span class="dt">Either</span> <span class="dt">String</span> a</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>          ,<span class="ot"> feDesc  ::</span> <span class="dt">String</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>          ,<span class="ot"> feIdent ::</span> <span class="dt">String</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> <span class="dt">FormElem</span> a</span></code></pre></div>
<p>A <code>FormElem a</code> will contain:</p>
<ul>
<li>The <code>Elem b</code> representing the actual native form element, with information required to render it.</li>
<li>A function <code>b -&gt; Either String a</code>, which lets you <em>parse</em> the element’s native output into an <code>a</code> (what the <code>FormElem</code> outputs), with a potential <code>String</code> error message</li>
<li>A display name and identifier, which we will use to describe the element and as a part of the JSON schema for our JSON backend.</li>
</ul>
<h3 id="form">Form</h3>
<p>We now have a functor, <code>FormElem</code>, that is a single form element and all of its decorations. Now, for the magic — to make a full <code>Form</code> type, it’s just:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L39-L39</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Form</span> <span class="ot">=</span> <span class="dt">Alt</span> <span class="dt">FormElem</span></span></code></pre></div>
<p>Ta dah!</p>
<p>And just like that, we now have functions like:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Map over the results of a Form</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fmap</span><span class="ot">   ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">Form</span> a <span class="ot">-&gt;</span> <span class="dt">Form</span> b</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Combine two forms together, and merge their results with a combining</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- function</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ot">liftA2 ::</span> (a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> c) <span class="ot">-&gt;</span> <span class="dt">Form</span> a <span class="ot">-&gt;</span> <span class="dt">Form</span> b <span class="ot">-&gt;</span> <span class="dt">Form</span> c</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Combine all of the forms in a list to create a single form, whose result</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- is the collection of all of their results</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sequence</span><span class="ot"> ::</span> [<span class="dt">Form</span> a] <span class="ot">-&gt;</span> <span class="dt">Form</span> [a]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Duplicate a form multiple times, creating a new form whose reuslt is a</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- collection of all of their results</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="ot">replicateM ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Form</span> a <span class="ot">-&gt;</span> <span class="dt">Form</span> [a]</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Combine two forms together to create a final form whose result picks from</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">-- the two input forms</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="ot">(&lt;|&gt;) ::</span> <span class="dt">Form</span> a <span class="ot">-&gt;</span> <span class="dt">Form</span> a <span class="ot">-&gt;</span> <span class="dt">Form</span> a</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Combine several forms together to create a final form whose result picks</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>from one <span class="kw">of</span> the several options</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="ot">choice ::</span> [<span class="dt">Form</span> a] <span class="ot">-&gt;</span> <span class="dt">Form</span> a</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co">-- | Turn a form into an optional form</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="ot">optional ::</span> <span class="dt">Form</span> a <span class="ot">-&gt;</span> <span class="dt">Form</span> (<span class="dt">Maybe</span> a)</span></code></pre></div>
<p>All that for free. Neat!</p>
<p>Note – it is very important to use <code>Alt</code> from <em>Control.Alternative.Free.Final</em>, and <strong>not</strong> the one from <em>Control.Alternative.Free</em>. The <em>Control.Alternative.Free</em> <code>Alt</code> is broken for our use case, because it normalizes against <a href="https://stackoverflow.com/q/45647253/292731">an extra Alternative law</a> that forms do not obey.</p>
<h2 id="making-real-forms">Making Real Forms</h2>
<h3 id="primitive-forms">Primitive Forms</h3>
<p>Let’s create a set of primitive <code>Form</code>s, which we will use to build up our more complex ones.</p>
<p>First, a <code>Form String</code> with a single text box:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L41-L50</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>stringInput</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    ::</span> <span class="dt">String</span>           <span class="co">-- ^ description</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ identifier</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Form</span> <span class="dt">String</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>stringInput desc ident <span class="ot">=</span> liftAlt <span class="op">$</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FE</span> { feElem  <span class="ot">=</span> <span class="dt">EText</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>       , feParse <span class="ot">=</span> mfilter (<span class="fu">not</span> <span class="op">.</span> <span class="fu">null</span>) <span class="op">.</span> <span class="dt">Right</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>       , feDesc  <span class="ot">=</span> desc</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>       , feIdent <span class="ot">=</span> ident</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>       }</span></code></pre></div>
<p>Note that its <code>String -&gt; Either String String</code> function is just <code>Right</code>, since it is always a “successful” parse.</p>
<p>And maybe one that is based on a text box, but instead of just outputting the output <code>String</code>, it parses it into a Haskell value using <code>Read</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L52-L63</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>readInput</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    ::</span> (<span class="dt">Read</span> a, <span class="dt">Show</span> a)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ description</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ identifier</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Form</span> a</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>readInput desc ident <span class="ot">=</span> liftAlt <span class="op">$</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FE</span> { feElem  <span class="ot">=</span> <span class="dt">EText</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>       , feParse <span class="ot">=</span> <span class="fu">maybe</span> (<span class="dt">Left</span> (<span class="st">&quot;Could not parse &quot;</span> <span class="op">++</span> ident)) <span class="dt">Right</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                 <span class="op">.</span> readMaybe</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>       , feDesc  <span class="ot">=</span> desc</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>       , feIdent <span class="ot">=</span> ident</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>       }</span></code></pre></div>
<p>Now two “numerical” inputs – one expecting <code>Integral</code> values, and another expecting floating-point values.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L65-L88</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>intInput</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    ::</span> <span class="dt">Integral</span> a</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=&gt;</span> <span class="dt">String</span>     <span class="co">-- ^ description</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">String</span>     <span class="co">-- ^ identifier</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Form</span> a</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>intInput desc ident <span class="ot">=</span> liftAlt <span class="op">$</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FE</span> { feElem  <span class="ot">=</span> <span class="dt">ENumber</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>       , feParse <span class="ot">=</span> <span class="fu">either</span> (\_ <span class="ot">-&gt;</span> <span class="dt">Left</span> (ident <span class="op">++</span> <span class="st">&quot; should be integer&quot;</span>)) <span class="dt">Right</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                 <span class="op">.</span> floatingOrInteger <span class="op">@</span><span class="dt">Double</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>       , feDesc  <span class="ot">=</span> desc</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>       , feIdent <span class="ot">=</span> ident</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>floatInput</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="ot">    ::</span> <span class="dt">RealFloat</span> a</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ description</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ identifier</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Form</span> a</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>floatInput desc ident <span class="ot">=</span> liftAlt <span class="op">$</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FE</span> { feElem  <span class="ot">=</span> <span class="dt">ENumber</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>       , feParse <span class="ot">=</span> <span class="dt">Right</span> <span class="op">.</span> <span class="fu">realToFrac</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>       , feDesc  <span class="ot">=</span> desc</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>       , feIdent <span class="ot">=</span> ident</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>       }</span></code></pre></div>
<p>A simple drop-down menu element that lets the user pick from a list of items:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L90-L99</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>selectInput</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    ::</span> <span class="dt">Show</span> a</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ description</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ identifier</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> [a]              <span class="co">-- ^ options</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Form</span> a</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>selectInput desc ident opts <span class="ot">=</span> liftAlt <span class="op">$</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FE</span> (<span class="dt">ESelect</span> (<span class="fu">show</span> <span class="op">&lt;$&gt;</span> opts)) p desc ident</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> <span class="fu">maybe</span> (<span class="dt">Left</span> (<span class="st">&quot;No selection for &quot;</span> <span class="op">++</span> ident)) (<span class="dt">Right</span> <span class="op">.</span> (opts <span class="op">!!</span>))</span></code></pre></div>
<p>And a simple check box, which outputs one of two items:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L101-L114</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>checkInput</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    ::</span> <span class="dt">Show</span> a</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ description</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">String</span>           <span class="co">-- ^ identifier</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> a                <span class="co">-- ^ unchecked option</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> a                <span class="co">-- ^ checked option</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Form</span> a</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>checkInput desc ident x y <span class="ot">=</span> liftAlt <span class="op">$</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FE</span> (<span class="dt">ECheck</span> (<span class="fu">show</span> x) (<span class="fu">show</span> y)) p desc ident</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> <span class="dt">Right</span> <span class="op">.</span> bool x y</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="ot">boolInput ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Form</span> <span class="dt">Bool</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>boolInput desc ident <span class="ot">=</span> checkInput desc ident <span class="dt">False</span> <span class="dt">True</span></span></code></pre></div>
<h3 id="sample-form">Sample Form</h3>
<p>To explore this type, let’s make a sample form which we will be re-using for the rest of this post!</p>
<p>We will be making a registration form, a form producing an account, which contains:</p>
<ol type="1">
<li>A name</li>
<li>An optional age</li>
<li>A favorite color (from one of the pre-defined color, or a custom one)</li>
<li>An account type (normal account, or premium account?)</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L116-L127</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">AccountType</span> <span class="ot">=</span> <span class="dt">Normal</span> <span class="op">|</span> <span class="dt">Premium</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">deriving</span> <span class="dt">Show</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Color</span> <span class="ot">=</span> <span class="dt">Red</span> <span class="op">|</span> <span class="dt">Blue</span> <span class="op">|</span> <span class="dt">Orange</span> <span class="op">|</span> <span class="dt">Yellow</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">deriving</span> <span class="dt">Show</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Account</span> <span class="ot">=</span> <span class="dt">Acc</span> {<span class="ot"> accName     ::</span> <span class="dt">String</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                   ,<span class="ot"> accAge      ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                   ,<span class="ot"> accFavColor ::</span> <span class="dt">Either</span> <span class="dt">Color</span> <span class="dt">String</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                   ,<span class="ot"> accPremium  ::</span> <span class="dt">AccountType</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">deriving</span> <span class="dt">Show</span></span></code></pre></div>
<p>And we’ll make the form using Applicative style:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L129-L138</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="ot">accountForm ::</span> <span class="dt">Form</span> <span class="dt">Account</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>accountForm <span class="ot">=</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Acc</span> <span class="op">&lt;$&gt;</span> stringInput <span class="st">&quot;Name&quot;</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;*&gt;</span> optional (intInput <span class="st">&quot;Age&quot;</span> <span class="st">&quot;age&quot;</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;*&gt;</span> (<span class="dt">Left</span> <span class="op">&lt;$&gt;</span> favColor <span class="op">&lt;|&gt;</span> <span class="dt">Right</span> <span class="op">&lt;$&gt;</span> customColor)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;*&gt;</span> checkInput <span class="st">&quot;Premium Account&quot;</span> <span class="st">&quot;premium&quot;</span> <span class="dt">Normal</span> <span class="dt">Premium</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    favColor    <span class="ot">=</span> selectInput <span class="st">&quot;Favorite Color&quot;</span> <span class="st">&quot;fav-color&quot;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                    [<span class="dt">Red</span>, <span class="dt">Blue</span>, <span class="dt">Orange</span>, <span class="dt">Yellow</span>]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    customColor <span class="ot">=</span> stringInput <span class="st">&quot;Custom Color&quot;</span> <span class="st">&quot;custum-color&quot;</span></span></code></pre></div>
<p>If you’re feeling fancy, you can also make it using “Applicative Do” style, which makes it a little more flexible if you want to re-arrange the items in the form (put the “age” field before the “name” field, etc.)</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- source: https://github.com/mstksg/inCode/tree/master/code-samples/free-applicative-forms/Form.hs#L140-L148</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ot">accountFormAdo ::</span> <span class="dt">Form</span> <span class="dt">Account</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>accountFormAdo <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    nam <span class="ot">&lt;-</span> stringInput <span class="st">&quot;Name&quot;</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    age <span class="ot">&lt;-</span> optional <span class="op">$</span> intInput <span class="st">&quot;Age&quot;</span> <span class="st">&quot;age&quot;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    col <span class="ot">&lt;-</span> <span class="dt">Left</span>  <span class="op">&lt;$&gt;</span> selectInput <span class="st">&quot;Favorite Color&quot;</span> <span class="st">&quot;fav-color&quot;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                       [<span class="dt">Red</span>, <span class="dt">Blue</span>, <span class="dt">Orange</span>, <span class="dt">Yellow</span>]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>       <span class="op">&lt;|&gt;</span> <span class="dt">Right</span> <span class="op">&lt;$&gt;</span> stringInput <span class="st">&quot;Custom Color&quot;</span> <span class="st">&quot;custom-color&quot;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    typ <span class="ot">&lt;-</span> checkInput <span class="st">&quot;Premium Account&quot;</span> <span class="st">&quot;premium&quot;</span> <span class="dt">Normal</span> <span class="dt">Premium</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pure</span> (<span class="dt">Acc</span> nam age col typ)</span></code></pre></div></div><footer><hr><div class="copy-content"><p>Hi, thanks for reading! You can reach me via email at <a href="mailto:justin@jle.im" class="email">justin@jle.im</a>, or at twitter at <a href="https://twitter.com/mstk">@mstk</a>! This post and all others are published under the <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/">CC-BY-NC-ND 3.0</a> license. Corrections and edits via pull request are welcome and encouraged at <a href="https://github.com/mstksg/inCode">the source repository</a>.</p>
<p>If you feel inclined, or this post was particularly helpful for you, why not consider <a href="https://www.patreon.com/justinle/overview">supporting me on Patreon</a>, or a <a href="bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU">BTC donation</a>? :)</p></div><div class="clear"></div><ul class="entry-series"></ul><ul class="tag-list"><li><a href="https://blog.jle.im/entries/tagged/free.html" class="tag-a-tag">#free</a></li><li><a href="https://blog.jle.im/entries/tagged/functional-programming.html" class="tag-a-tag">#functional programming</a></li><li><a href="https://blog.jle.im/entries/tagged/ghcjs.html" class="tag-a-tag">#ghcjs</a></li><li><a href="https://blog.jle.im/entries/tagged/haskell.html" class="tag-a-tag">#haskell</a></li><li><a href="https://blog.jle.im/entries/tagged/types.html" class="tag-a-tag">#types</a></li><li><a href="https://blog.jle.im/entries/category/@haskell.html" class="tag-a-category">@HASKELL</a></li></ul><aside class="social-buttons"><div class="addthis_toolbox addthis_default_style addthis-buttons"><a class="addthis_button_facebook_like" fb:like:layout="button_count"></a><a class="addthis_button_tweet"></a><a class="addthis_button_google_plusone" g:plusone:size="medium"></a><a class="addthis_counter addthis_pill_style"></a></div><div class="custom-social-buttons"><div class="custom-social-button"><a href="https://www.reddit.com/submit" onclick="window.location = &#39;https://www.reddit.com/submit?url=&#39;+ encodeURIComponent(window.location); return false"><img src="https://www.reddit.com/static/spreddit7.gif" alt="submit to reddit"></a></div></div></aside><nav class="next-prev-links"><ul><li class="next-entry-link">(Next) <a href="https://blog.jle.im/entry/introducing-in-code.html">Introducing &quot;in Code&quot;!</a> &rarr;</li></ul></nav></footer></article><div class="post-entry"><div class="tile"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://blog.jle.im/entry/forms-with-free-applicative-alternative.html';
    this.page.identifier = 'free-applicative-forms';
};
(function() {
    var d = document, s = d.createElement('script');
    s.src = '//incode.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a><br></noscript><a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a></div></div></div></div></div><div id="footer-container"><div id="footer-content"><div class="tile"><div class="footer-copyright">&copy; 2020 Justin Le <span class="license-link">(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" class="license">CC-BY-NC-ND 3.0</a>)</span></div><div class="footer-follow social-follows"><ul class="social-follows-list"><li><ul class="social-follows-list-social"><li><a class="social-follow-twitter" title="Follow me on Twitter!" href="https://twitter.com/intent/user?user_id=mstk" onclick="window.open(
  &#39;http://twitter.com/intent/user?user_id=907281&#39;,
  &#39;facebook-share-dialog&#39;,
  &#39;width=550,height=520&#39;);
return false;
">Twitter</a></li><li><a class="social-follow-github" title="Fork me on Github!" href="https://github.com/mstksg">Github</a></li><li><a class="social-follow-twitch" title="Watch me on Twitch!" href="https://www.twitch.tv/justin_l">Twitch</a></li><li><a class="social-follow-patreon" title="Support me on Patreon!" href="https://www.patreon.com/justinle/overview">Patreon</a></li><li><a class="social-follow-gplus" title="Add me on Google+!" href="https://plus.google.com/+JustinLe">Google+</a></li><li><a class="social-follow-keybase" title="Track me on Keybase!" href="https://keybase.io/mstksg">Keybase</a></li><li><a class="social-follow-linkedin" title="Connect with me on LinkedIn!" href="https://linkedin.com/in/lejustin">LinkedIn</a></li><li><a class="social-follow-bitcoin" title="Donate via bitcoin!" href="bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU">Bitcoin</a></li></ul></li><li><ul class="social-follows-list-site"><li><a class="social-follow-rss" title="Subscribe to my RSS Feed!" href="http://feeds.feedburner.com/incodeblog">RSS</a></li><li><a class="social-follow-email" title="Subscribe to the mailing list!" href="https://feedburner.google.com/fb/a/mailverify?loc=en_US&amp;uri=incodeblog">Mailing list</a></li></ul></li></ul></div></div></div></div></body></html>